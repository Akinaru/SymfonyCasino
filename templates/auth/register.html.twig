{% extends 'auth/base_auth.html.twig' %}

{% block title %}üé∞ Symfsino - Inscription{% endblock %}

{% block content %}
    <div class="text-white">
        <h1>Cr√©er un compte</h1>

        {# Affiche les erreurs globales du formulaire (ex : CSRF) #}
        {% if registrationForm.vars.errors|length %}
            <div class="alert alert-danger mb-3">
                {{ form_errors(registrationForm) }}
            </div>
        {% endif %}

        {% set ns = registrationForm.vars.id %}
        {% set avatarInputId = ns ~ '-avatar-input' %}
        {% set avatarPreviewId = ns ~ '-avatar-preview' %}
        {% set currentAvatar = registrationForm.avatar.vars.value ?? '' %}

        {{ form_start(registrationForm, { attr: { novalidate: 'novalidate', 'data-turbo': 'false' } }) }}
        {{ form_row(registrationForm.pseudo) }}
        {{ form_row(registrationForm.email) }}

        {# Champ avatar + aper√ßu live #}
        <div class="mb-3">
            {{ form_label(registrationForm.avatar) }}
            {{ form_widget(registrationForm.avatar, { id: avatarInputId }) }}
            <div class="mt-2">
                <img
                    id="{{ avatarPreviewId }}"
                    src="https://mc-heads.net/avatar/{{ currentAvatar is not empty ? currentAvatar|url_encode ~ '/128' : 'Steve/128' }}"
                    alt="Aper√ßu avatar"
                    width="96" height="96"
                    class="img-thumbnail border-secondary"
                    style="object-fit: cover;"
                >
            </div>
            {{ form_help(registrationForm.avatar) }}
            {{ form_errors(registrationForm.avatar) }}
        </div>

        {{ form_row(registrationForm.plainPassword) }}

        <button class="btn btn-primary">S'inscrire</button>
        {{ form_end(registrationForm) }}

        <p class="mt-3">
            D√©j√† un compte ?
            <a href="{{ path('app_login') }}">Se connecter</a>
        </p>
    </div>

    <script>
        (function () {
            const input = document.getElementById('{{ avatarInputId }}');
            const preview = document.getElementById('{{ avatarPreviewId }}');
            if (!input || !preview) return;

            const update = () => {
                const v = (input.value || '').trim();
                const name = v !== '' ? encodeURIComponent(v) : 'Steve';
                preview.src = `https://mc-heads.net/avatar/${name}/128`;
            };

            input.addEventListener('input', update);
        })();
    </script>
{% endblock %}
