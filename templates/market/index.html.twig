{% extends 'base_front.html.twig' %}
{% block title %}Marché noir{% endblock %}

{% block page_content %}
    <div class="card bg-dark border-secondary">
        <div class="card-header border-secondary d-flex justify-content-between align-items-center">
            <h1 class="h5 mb-0 text-light">Marché noir</h1>
            {% if app.user %}
                <small class="text-white-50">Votre balance : {{ app.user.balance }}</small>
            {% endif %}
        </div>
        <div class="card-body">
            <div class="row g-3">
                {% for it in items %}
                    <div class="col-12 col-md-6 col-lg-4">
                        <div class="border rounded h-100 p-3 d-flex gap-3 align-items-center">
                            <img src="{{ asset(it.imagePath) }}" alt="" style="width:48px;height:48px; image-rendering: pixelated;">
                            <div class="flex-grow-1">
                                <div class="text-white fw-semibold">{{ it.name }}</div>
                                <div class="text-white-50 small">{{ it.typeLabel }}</div>
                                <div class="mt-1">Prix : <span class="badge text-bg-warning">{{ it.price }}</span></div>
                            </div>
                            <div>
                                {% if app.user %}
                                    <form method="post" action="{{ path('app_market_buy', {id: it.id}) }}">
                                        <input type="hidden" name="_token" value="{{ csrf_token('buy_item_' ~ it.id) }}">
                                        <button class="btn btn-sm btn-success" {% if app.user.balance < it.price %}disabled{% endif %}>
                                            Acheter
                                        </button>
                                    </form>
                                {% else %}
                                    <span class="text-white-50 small">Connectez-vous</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                {% else %}
                    <div class="col-12 text-center text-white-50">Rien en vente pour l’instant.</div>
                {% endfor %}
            </div>
        </div>
    </div>
{% endblock %}
