{# templates/profile/index.html.twig #}
{% extends 'profile/base_profil.html.twig' %}

{% block title %}ðŸŽ° Symfsino - Profil{% endblock %}

{% block profile_content %}
    <style>
        .profile-stat-card {
            border-radius: 1rem;
            border: 1px solid rgba(255, 255, 255, .06);
            background:
                radial-gradient(circle at top, rgba(255, 255, 255, 0.06), transparent 55%),
                linear-gradient(145deg, rgba(10, 10, 24, 0.95), rgba(5, 5, 18, 0.98));
            padding: 0.9rem 1rem;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            transition:
                transform .18s ease,
                box-shadow .18s ease,
                border-color .18s ease,
                background .18s ease;
        }

        .profile-stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 0.9rem 1.6rem rgba(0, 0, 0, 0.85);
            border-color: rgba(255, 255, 255, 0.16);
            background:
                radial-gradient(circle at top, rgba(255, 255, 255, 0.09), transparent 55%),
                linear-gradient(145deg, rgba(16, 16, 40, 0.98), rgba(6, 6, 22, 1));
        }

        .profile-stat-label {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: .09em;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 0.25rem;
        }

        .profile-stat-value {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .profile-stat-sub {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.65);
        }

        .profile-stat-pill {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            padding: 0.2rem 0.55rem;
            border-radius: 999px;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: .1em;
            background-color: rgba(0, 0, 0, 0.55);
            border: 1px solid rgba(255, 255, 255, 0.08);
            color: rgba(255, 255, 255, 0.75);
        }
    </style>

    <div class="py-4 text-white text-white-scope">
        <h1 class="h4 mb-3">Mes statistiques</h1>

        <div class="row g-3 mb-4">

            <div class="col-6 col-lg-3">
                <div class="profile-stat-card">
                    <div class="profile-stat-label">Pseudo</div>
                    <div class="profile-stat-value">{{ app.user.pseudo ?? 'â€”' }}</div>
                </div>
            </div>

            <div class="col-6 col-lg-3">
                <div class="profile-stat-card">
                    <div class="profile-stat-label">Wager total</div>
                    <div class="profile-stat-value">
                        <span class="balance">
                            {{ app.user.wagger|default(0)|number_format(0, ',', ' ') }}
                        </span>
                    </div>
                </div>
            </div>

            <div class="col-6 col-lg-3">
                <div class="profile-stat-card">
                    <div class="profile-stat-label">Nombre de paris</div>
                    <div class="profile-stat-value">
                        {{ stats.betsCount|default(0) }}
                    </div>
                </div>
            </div>

            <div class="col-6 col-lg-3">
                <div class="profile-stat-card">
                    <div class="profile-stat-label">Taux de victoire</div>
                    <div class="profile-stat-value {{ (stats.winRate|default(0)) >= 50 ? 'text-success' : 'text-warning' }}">
                        {{ stats.winRate|default(0)|number_format(1, ',', ' ') }}%
                    </div>
                </div>
            </div>

            <div class="col-6 col-lg-3">
                <div class="profile-stat-card">
                    <div class="profile-stat-label">Mise moyenne</div>
                    <div class="profile-stat-value">
                        <span class="balance">
                            {{ stats.avgBet|default(0)|number_format(0, ',', ' ') }}
                        </span>
                    </div>
                </div>
            </div>

            <div class="col-6 col-lg-3">
                <div class="profile-stat-card">
                    <div class="profile-stat-label">Plus gros gain</div>
                    <div class="profile-stat-value text-success">
                        <span class="balance">
                            {% if stats.biggestWin|default(0) > 0 %}+{% endif %}
                            {{ stats.biggestWin|default(0)|number_format(0, ',', ' ') }}
                        </span>
                    </div>
                </div>
            </div>

            <div class="col-6 col-lg-3">
                <div class="profile-stat-card">
                    <div class="d-flex justify-content-between align-items-center mb-1">
                        <div class="profile-stat-label mb-0">Jeu favori</div>
                        <span class="profile-stat-pill">
                            Favori
                        </span>
                    </div>
                    <div class="profile-stat-value">
                        {% set _fav = stats.favoriteGameKey|default(null) %}
                        {{ _fav ? (namesByKey[_fav]|default(_fav)) : 'â€”' }}
                    </div>
                </div>
            </div>

            <div class="col-6 col-lg-3">
                <div class="profile-stat-card">
                    <div class="d-flex justify-content-between align-items-center mb-1">
                        <div class="profile-stat-label mb-0">Dernier jeu</div>
                        <span class="profile-stat-pill">
                            DerniÃ¨re session
                        </span>
                    </div>
                    <div class="profile-stat-value">
                        {% set _last = stats.lastGameKey|default(null) %}
                        {{ _last ? (namesByKey[_last]|default(_last)) : 'â€”' }}
                    </div>
                </div>
            </div>

        </div>

        <h1 class="h4 mb-3">Mes informations</h1>

        {{ form_start(form, { attr: { novalidate: 'novalidate', 'data-turbo': 'false' } }) }}
        {{ form_errors(form) }}

        <div class="row g-4">
            <div class="col-md-6">
                <div class="mb-3">
                    {{ form_label(form.pseudo, null, { label_attr: { class: 'form-label' } }) }}
                    {{ form_widget(form.pseudo, { attr: { class: 'form-control' } }) }}
                    {{ form_errors(form.pseudo) }}
                </div>

                <div class="mb-3">
                    {{ form_label(form.email, null, { label_attr: { class: 'form-label' } }) }}
                    {{ form_widget(form.email, { attr: { class: 'form-control' } }) }}
                    {{ form_errors(form.email) }}
                </div>

                {% if form.avatar is defined %}
                    <div class="mb-3">
                        {% set ns = form.vars.id %}
                        {% set avatarInputId = ns ~ '-avatar-input' %}
                        {% set avatarPreviewId = ns ~ '-avatar-preview' %}
                        {% set currentAvatar = form.avatar.vars.value ? form.avatar.vars.value : '' %}

                        {{ form_label(form.avatar, null, { label_attr: { class: 'form-label' } }) }}
                        {{ form_widget(form.avatar, { id: avatarInputId, attr: { class: 'form-control' } }) }}
                        {{ form_errors(form.avatar) }}

                        <div class="mt-3">
                            <div class="form-text text-white mb-2">AperÃ§u de lâ€™avatar</div>
                            <img
                                id="{{ avatarPreviewId }}"
                                src="https://mc-heads.net/avatar/{{ currentAvatar is not empty ? currentAvatar|url_encode ~ '/128' : 'Steve/128' }}"
                                alt="AperÃ§u avatar"
                                width="128" height="128"
                                class="img-thumbnail"
                                style="object-fit: cover;"
                            >
                        </div>
                    </div>
                {% endif %}
            </div>

            <div class="col-md-6">
                <h5 class="mb-2">Changer le mot de passe</h5>
                <p class="mb-3">Laissez ces champs vides si vous ne souhaitez pas modifier votre mot de passe.</p>

                <div class="mb-3">
                    {{ form_label(form.currentPassword, null, { label_attr: { class: 'form-label' } }) }}
                    {{ form_widget(form.currentPassword, { attr: { class: 'form-control' } }) }}
                    {{ form_errors(form.currentPassword) }}
                </div>

                <div class="mb-3">
                    {{ form_label(form.newPassword, null, { label_attr: { class: 'form-label' } }) }}
                    {{ form_widget(form.newPassword, { attr: { class: 'form-control' } }) }}
                    {{ form_errors(form.newPassword) }}
                </div>

                <div class="mb-0">
                    {{ form_label(form.confirmPassword, null, { label_attr: { class: 'form-label' } }) }}
                    {{ form_widget(form.confirmPassword, { attr: { class: 'form-control' } }) }}
                    {{ form_errors(form.confirmPassword) }}
                </div>
            </div>
        </div>

        {{ form_rest(form) }}

        <div class="mt-3">
            <button type="submit" class="btn btn-primary">Mettre Ã  jour</button>
        </div>

        {{ form_end(form) }}
    </div>

    <script>
        (function () {
            const input = document.getElementById('{{ form.vars.id ~ "-avatar-input" }}');
            const preview = document.getElementById('{{ form.vars.id ~ "-avatar-preview" }}');
            if (!input || !preview) return;
            const update = () => {
                const v = (input.value || '').trim();
                const name = v !== '' ? encodeURIComponent(v) : 'Steve';
                preview.src = `https://mc-heads.net/avatar/${name}/128`;
            };
            input.addEventListener('input', update);
        })();
    </script>
{% endblock %}
