{# Bloc reutilisable pour l'affichage Slots â€” strictement ton code existant #}

{% set itemImgs = {
    'slot1': asset('img/slots/slot1.png'),
    'slot2': asset('img/slots/slot2.png'),
    'slot3': asset('img/slots/slot3.png'),
    'slot4': asset('img/slots/slot4.png'),
    'slot5': asset('img/slots/slot5.png'),
    'slot6': asset('img/slots/slot6.png'),
    'slot7': asset('img/slots/slot7.png'),
    'slot8': asset('img/slots/slot8.png')
} %}

{% set winMap = {} %}
{% for w in record.wins %}
    {% for pos in w.positions|default([]) %}
        {% set key = pos[0] ~ '-' ~ pos[1] %}
        {% set winMap = winMap|merge({ (key): true }) %}
    {% endfor %}
{% endfor %}

<div class="card-body">

    <div class="d-flex flex-wrap align-items-center gap-3 mb-3">
        <span class="badge text-bg-success">+{{ record.partie.gain|number_format(0, ',', ' ') }}</span>
        <span class="text-white-50 small">Mise {{ record.partie.mise|number_format(0, ',', ' ') }}</span>
    </div>

    {% if record.grid is iterable %}
        <div class="p-2 rounded" style="background: rgba(255,255,255,.03); border:1px solid rgba(255,255,255,.08);">
            <div class="d-grid" style="grid-template-columns: repeat(3, 1fr); gap:10px;">
                {% for r in 0..2 %}
                    {% for c in 0..2 %}
                        {% set sym = record.grid[r][c] %}
                        {% set img = itemImgs[sym]|default(asset('img/slots/slot8.png')) %}
                        {% set key = r ~ '-' ~ c %}
                        {% set isWin = key in winMap|keys %}

                        <div class="d-flex align-items-center justify-content-center rounded position-relative"
                             style="height:72px; background:#0f0f12; border:1px solid rgba(255,255,255,.06); box-shadow: inset 0 0 0 1px rgba(255,255,255,.02);">
                            <img src="{{ img }}" alt="{{ sym }}" width="44" height="44"
                                 style="object-fit:contain; image-rendering:-webkit-optimize-contrast;">
                            {% if isWin %}
                                <span class="position-absolute top-0 start-0 w-100 h-100"
                                      style="border:2px solid rgba(39,174,96,.75); border-radius:8px; box-shadow:0 0 12px rgba(39,174,96,.35) inset;"></span>
                            {% endif %}
                        </div>

                    {% endfor %}
                {% endfor %}
            </div>
        </div>

    {% else %}
        <div class="text-white-50">Grille indisponible.</div>
    {% endif %}

</div>
